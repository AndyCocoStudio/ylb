!function(){var e={path:"list",goodsid:"",sz:20,cp:1,t:0,detail:{name:"",price:"",weight:"",freight:"",thumbnail:[],introduceImages:[],brief:{content:"",img:""},info:[{name:"",value:""}],deduction:"",sku:"",vendorID:"",status:"OnSell",kind1:"",kind1Code:"",kind2:"",kind2Code:""},eidt:{goodsID:"",name:"",price:"",weight:"",freight:"",thumbnail:[],introduceImages:[],brief:{content:"",img:""},info:[{name:"",value:""}],deduction:"",sku:"",vendorID:"",status:"OnSell",kind1:"",kind1Code:"",kind2:"",kind2Code:""},flist:[],slist:[]},i={init:function(){i.getFlist()},getData:function(){$.when($.ajax({url:$.apiUrl+"/goods/query?sz="+e.sz+"&cp="+e.cp,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.list=a.data.goodses,e.t=a.data.totalCount,e.edit=e.list[0],i.buildVue()})})},getGoods:function(i){$.when($.ajax({url:$.apiUrl+"/goods?id="+i,type:"GET"})).done(function(i){$.ylbAjaxHandler(i,function(){$.ajax({url:$.apiUrl+"/goods/kinds?all=1&code="+i.data.kind1Code,type:"GET"}).done(function(i){i.result&&(e.slist=i.data)}),e.edit=i.data,e.path="edit"})})},getFlist:function(){$.ajax({url:$.apiUrl+"/goods/kinds?all=1",type:"GET"}).done(function(a){a.result&&(e.flist=a.data,i.getData())})},imgUpload:function(){$("#lbt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.thumbnail.push(a.data)}}),$("#gst").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.brief.img=a.data}}),$("#spxqt1").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt2").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt3").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#lbt1").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.thumbnail.push(a.data)}}),$("#gst1").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.brief.img=a.data}}),$("#spxqt11").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt22").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt33").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}})},buildVue:function(){e=new Vue({el:"#product-main",data:e,methods:{addGoods:function(){e.path="add"},editGoods:function(e){i.getGoods(e)},cancel:function(){e.path="list"},delGoods:function(e){var a=confirm("确认删除该商品？");a&&$.ajax({url:$.apiUrl+"/goods?id="+e,type:"DELETE"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("删除成功！"),i.getData()})})},addparam:function(){var i={name:"",value:""};e.detail.info.push(i)},delparam:function(i){e.detail.info.splice(i,1)},eaddparam:function(){var i={name:"",value:""};e.edit.info.push(i)},edelparam:function(i){e.edit.info.splice(i,1)},setflist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.detail.kind1=a,e.detail.kind1Code=t,$.ajax({url:$.apiUrl+"/goods/kinds?all=1&code="+t,type:"GET"}).done(function(i){i.result&&(e.slist=i.data)})},esetflist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.edit.kind1=a,e.edit.kind1Code=t,$.ajax({url:$.apiUrl+"/goods/kinds?all=1&code="+t,type:"GET"}).done(function(i){i.result&&(e.slist=i.data)})},setslist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.detail.kind2=a,e.detail.kind2Code=t},esetslist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.edit.kind2=a,e.edit.kind2Code=t},newPro:function(){$.ajax({url:$.apiUrl+"/goods",type:"PUT",data:JSON.stringify(e.detail)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("编辑成功"),i.getData(),e.path="list",e.detail={name:"",price:"",weight:"",freight:"",thumbnail:[],introduceImages:[],brief:{content:"",img:""},info:[{name:"",value:""}],deduction:"",sku:"",vendorID:"",status:"OnSell",kind1:"",kind1Code:"",kind2:"",kind2Code:""}})})},editPro:function(){$.ajax({url:$.apiUrl+"/goods",type:"POST",data:JSON.stringify(e.edit)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("编辑成功"),e.path="list",i.getData()})})},prev:function(){e.cp<=1||(e.cp=+e.cp-1,i.getData())},next:function(){e.cp>=Math.ceil(e.t/e.sz)||(e.cp=+e.cp+1,i.getData())},jump:function(){e.cp>=Math.ceil(e.t/e.sz)&&(e.cp=Math.ceil(e.t/e.sz)),e.cp<=1&&(e.cp=1),i.getData()}}}),setTimeout(function(){i.imgUpload()},1e3)}};i.init()}();