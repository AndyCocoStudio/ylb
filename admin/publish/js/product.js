!function(){var e={path:"list",goodsid:"",detail:{goodsID:"",name:"",price:"",weight:"",freight:"",thumbnail:[],introduceImages:[],brief:{content:"",img:""},info:[{name:"",value:""}],deduction:"",sku:"",vendorID:"",status:"",kind1:"",kind1Code:"",kind2:"",kind2Code:""},flist:[],slist:[]},i={init:function(){i.getFlist()},getData:function(){$.when($.ajax({url:$.apiUrl+"/goods/query",type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.list=a.data,i.buildVue()})})},getFlist:function(){$.ajax({url:$.apiUrl+"/goods/kinds?all=1",type:"GET"}).done(function(a){a.result&&(e.flist=a.data,i.getData())})},imgUpload:function(){$("#lbt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.thumbnail.push(a.data)}}),$("#gst").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.brief.img=a.data}}),$("#spxqt1").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt2").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}}),$("#spxqt3").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:3,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(i,a){e.detail.introduceImages.push(a.data)}})},buildVue:function(){e=new Vue({el:"#product-main",data:e,methods:{editGoods:function(i){e.path="edit",i&&(e.goodsid=i)},cancel:function(){e.path="list"},delGoods:function(e){var a=e.target.attributes["data-id"].value;$.ajax({url:$.apiUrl+"/goods?id="+a,type:"DELETE"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("删除成功！"),i.getData()})})},addparam:function(){var i={name:"",value:""};e.detail.info.push(i)},delparam:function(i){e.detail.info.splice(i,1)},setflist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.kind1=a,e.kind1Code=t,$.ajax({url:$.apiUrl+"/goods/kinds?all=1&code="+t,type:"GET"}).done(function(i){i.result&&(e.slist=i.data)})},setslist:function(i){var a=$(i.target).find("option:selected").text(),t=$(i.target).find("option:selected").val();e.kind2=a,e.kind2Code=t},setData:function(){var a="";a=e.goodsid?"POST":"PUT",$.ajax({url:$.apiUrl+"/goods",type:a,data:JSON.stringify(e.detail)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("编辑成功"),i.getData(),e.path="list"})})}}}),setTimeout(function(){i.imgUpload()},1e3)}};i.init()}();