!function(){var e={sid:$.getID(),avatar:!1,address:!1,password:!0,detail:!1,newpwd:!1,counting:!1,countdown:0,num:60,confirmpwd:"",pwd:{currentPassword:"",newPassword:""},repwd:{mobile:"",captcha:"",password:""},newaddress:{id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1},userinfo:{gender:"f",name:"",mobile:"",idCard:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:""},useravatar:"",plist:[],clist:[],alist:[]},a={init:function(){$.checkSession(),a.getPlist(),a.getUserInfo(),a.uploadavatar()},uploadavatar:function(){$("#txsc").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,t){e.useravatar=t.data}})},createQRcode:function(){var a="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;$("#customer-private-qrcode").qrcode({render:"table",width:130,height:130,text:a})},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.info=t.data,e.useravatar=t.data.avatar,e.repwd.mobile=t.data.mobile,a.getAddress()})})},getAddress:function(){$.when($.ajax({url:$.apiUrl+"/user/addresses",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.addrList=t.data,a.getDetail()})})},getDetail:function(){$.when($.ajax({url:$.apiUrl+"/user/detail",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.userDetail=t.data,e.userinfo=t.data,a.buildVue()})})},getPlist:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.plist=a.data})})},getClist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.clist=a.data})})},getAlist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.alist=a.data})})},countDown:function(){e.num>1?(e.num-=1,$(".btn-code").val(e.num+"秒后重新获取")):(e.counting=!1,$(".btn-code").val("重新获取"),e.num=60,clearInterval(e.countdown))},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{changetap:function(e){var a=$(e.target),t=a.attr("data-role");switch(t){case"avatar":this.avatar=!0,this.address=!1,this.password=!1,this.detail=!1;break;case"address":this.avatar=!1,this.address=!0,this.password=!1,this.detail=!1;break;case"password":this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1;break;case"detail":this.avatar=!1,this.address=!1,this.password=!1,this.detail=!0;break;default:this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1}},setpaypwd:function(){return e.confirmpwd!==e.pwd.newPassword?void alert("两次输入的密码不一致"):void $.ajax({url:$.apiUrl+"/user/password",type:"POST",data:JSON.stringify(e.pwd)}).done(function(a){$.ylbAjaxHandler(a,function(){alert("密码设置成功"),e.pwd={currentPassword:"",newPassword:""},e.confirmpwd="",$.localStorageHandler("set","flag",!0),setTimeout(function(){window.location="/customer.html"},1500)})})},changeprov:function(t){var n=$(t.target),r=n.val(),d=n.find("option:selected").text();e.newaddress.provinceCode=r,e.newaddress.province=d,e.userinfo.provinceCode=r,e.userinfo.province=d,e.alist=[],a.getClist(r)},changecity:function(t){var n=$(t.target),r=n.val(),d=n.find("option:selected").text();e.newaddress.cityCode=r,e.newaddress.city=d,e.userinfo.cityCode=r,e.userinfo.city=d,a.getAlist(r)},changearea:function(a){var t=$(a.target),n=t.val(),r=t.find("option:selected").text();e.newaddress.areaCode=n,e.newaddress.area=r,e.userinfo.areaCode=n,e.userinfo.area=r},editaddress:function(t){e.newaddress.id=t.addressID,e.newaddress.name=t.name,e.newaddress.mobile=t.mobile,e.newaddress.province=t.province,e.newaddress.provinceCode=t.provinceCode,e.newaddress.city=t.city,e.newaddress.cityCode=t.cityCode,e.newaddress.area=t.area,e.newaddress.areaCode=t.areaCode,e.newaddress.street=t.street,e.newaddress.postCode=t.postCode,e.newaddress.isDefault=t.isDefault,a.getClist(t.provinceCode),a.getAlist(t.cityCode)},clearaddress:function(){e.newaddress={id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1}},saveaddress:function(){if(e.newaddress.id){var t={id:e.newaddress.id,name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"POST",data:JSON.stringify(t)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改地址成功"),a.getAddress()})})}else{var t={name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"PUT",data:JSON.stringify(t)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("地址添加成功"),a.getAddress()})})}},saveavatar:function(){$.ajax({url:$.apiUrl+"/user/avatar",type:"POST",data:JSON.stringify({avatar:e.useravatar})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("上传成功"),setTimeout(function(){window.location.href=window.location.href},1500)})})},changegender:function(a){var t=$(a.target).find("option:selected").val();e.userinfo.gender=t},saveuserinfo:function(){var a={avatar:e.userinfo.avatar,gender:e.userinfo.gender,name:e.userinfo.name,mobile:e.userinfo.mobile,idCard:e.userinfo.idCard,province:e.userinfo.province,provinceCode:e.userinfo.provinceCode,city:e.userinfo.city,cityCode:e.userinfo.cityCode,area:e.userinfo.area,areaCode:e.userinfo.areaCode,street:e.userinfo.street};$.ajax({url:$.apiUrl+"/user/detail",type:"POST",data:JSON.stringify(a)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改成功！")})})},getcode:function(){e.counting||(e.counting=!0,$.ajax({url:$.apiUrl+"/captcha",type:"PUT",data:JSON.stringify({mobile:e.repwd.mobile})}).done(function(t){$.ylbAjaxHandler(t,function(){$.ylbAlert("发送成功"),e.countdown=setInterval(a.countDown,1e3)})}))},resetpwd:function(){$.ajax({url:$.apiUrl+"/user/password/reset",type:"POST",data:JSON.stringify(e.repwd)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("修改成功！"),e.newpwd=!1})})}}}),a.createQRcode()}};a.init()}();