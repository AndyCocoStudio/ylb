!function(){var e={sid:$.getID(),avatar:!1,address:!1,password:!0,loginpwd:!1,detail:!1,newpwd:!1,counting:!1,countdown:0,num:60,confirmpwd:"",hasall:{},sqrcode:"",pwd:{currentPassword:"",newPassword:""},logpwd:{currentPassword:"",newPassword:""},repwd:{mobile:"",captcha:"",password:""},newaddress:{id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1},userinfo:{gender:"f",name:"",mobile:"",idCard:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:""},useravatar:"",plist:[],clist:[],alist:[]},a={init:function(){$.checkSession(),a.getPlist(),a.getUserInfo(),a.uploadavatar()},uploadavatar:function(){$("#txsc").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:5,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,d){e.useravatar=d.data}})},createQRcode:function(){var a="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;e.sqrcode||(e.sqrcode=$("#customer-private-qrcode").qrcode({render:"table",width:130,height:130,text:a}))},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(d){$.ylbAjaxHandler(d,function(){e.info=d.data,e.useravatar=d.data.avatar,e.repwd.mobile=d.data.mobile,a.getAddress()})})},getAddress:function(){$.when($.ajax({url:$.apiUrl+"/user/addresses",type:"GET"})).done(function(d){$.ylbAjaxHandler(d,function(){e.addrList=d.data,a.getDetail()})})},getDetail:function(){$.when($.ajax({url:$.apiUrl+"/user/detail",type:"GET"})).done(function(d){$.ylbAjaxHandler(d,function(){e.userinfo=d.data,d.data.name&&(e.hasall.hasname=!0),d.data.idCard&&(e.hasall.hasidCard=!0),d.data.gender&&(e.hasall.hasgender=!0),d.data.street&&(e.hasall.hasaddress=!0),(d.data.province||d.data.city||d.data.area)&&(e.hasall.hasarea=!0),a.buildVue()})})},getPlist:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.plist=a.data})})},getClist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.clist=a.data})})},getAlist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.alist=a.data})})},countDown:function(){e.num>1?(e.num-=1,$(".btn-code").val(e.num+"秒后重新获取")):(e.counting=!1,$(".btn-code").val("重新获取"),e.num=60,clearInterval(e.countdown))},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{changetap:function(e){var a=$(e.target),d=a.attr("data-role");switch(d){case"avatar":this.avatar=!0,this.address=!1,this.password=!1,this.detail=!1,this.loginpwd=!1;break;case"address":this.avatar=!1,this.address=!0,this.password=!1,this.detail=!1,this.loginpwd=!1;break;case"password":this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1,this.loginpwd=!1;break;case"detail":this.avatar=!1,this.address=!1,this.password=!1,this.detail=!0,this.loginpwd=!1;break;case"loginpwd":this.avatar=!1,this.address=!1,this.password=!1,this.detail=!1,this.loginpwd=!0;break;default:this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1,this.loginpwd=!1}},setpaypwd:function(){return e.confirmpwd!==e.pwd.newPassword?void alert("两次输入的密码不一致"):void $.ajax({url:$.apiUrl+"/user/password",type:"POST",data:JSON.stringify(e.pwd)}).done(function(a){$.ylbAjaxHandler(a,function(){alert("密码设置成功"),e.pwd={currentPassword:"",newPassword:""},e.confirmpwd="",$.localStorageHandler("set","flag",!0),setTimeout(function(){window.location="/customer.html"},1500)})})},setlogpwd:function(){return e.confirmlogpwd!==e.logpwd.newPassword?void alert("两次输入的密码不一致"):void $.ajax({url:$.apiUrl+"/user/login/password",type:"POST",data:JSON.stringify(e.logpwd)}).done(function(a){$.ylbAjaxHandler(a,function(){alert("密码设置成功"),e.logpwd={currentPassword:"",newPassword:""},e.confirmlogpwd=""})})},changeprov:function(d){var t=$(d.target),r=t.val(),n=t.find("option:selected").text();e.newaddress.provinceCode=r,e.newaddress.province=n,e.userinfo.provinceCode=r,e.userinfo.province=n,e.alist=[],a.getClist(r)},changecity:function(d){var t=$(d.target),r=t.val(),n=t.find("option:selected").text();e.newaddress.cityCode=r,e.newaddress.city=n,e.userinfo.cityCode=r,e.userinfo.city=n,a.getAlist(r)},changearea:function(a){var d=$(a.target),t=d.val(),r=d.find("option:selected").text();e.newaddress.areaCode=t,e.newaddress.area=r,e.userinfo.areaCode=t,e.userinfo.area=r},editaddress:function(d){e.newaddress.id=d.addressID,e.newaddress.name=d.name,e.newaddress.mobile=d.mobile,e.newaddress.province=d.province,e.newaddress.provinceCode=d.provinceCode,e.newaddress.city=d.city,e.newaddress.cityCode=d.cityCode,e.newaddress.area=d.area,e.newaddress.areaCode=d.areaCode,e.newaddress.street=d.street,e.newaddress.postCode=d.postCode,e.newaddress.isDefault=d.isDefault,a.getClist(d.provinceCode),a.getAlist(d.cityCode)},clearaddress:function(){e.newaddress={id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1}},saveaddress:function(){if(e.newaddress.id){var d={id:e.newaddress.id,name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"POST",data:JSON.stringify(d)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改地址成功"),a.getAddress()})})}else{var d={name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"PUT",data:JSON.stringify(d)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("地址添加成功"),a.getAddress()})})}},saveavatar:function(){$.ajax({url:$.apiUrl+"/user/avatar",type:"POST",data:JSON.stringify({avatar:e.useravatar})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("上传成功"),setTimeout(function(){window.location.href=window.location.href},1500)})})},changegender:function(a){var d=$(a.target).find("option:selected").val();e.userinfo.gender=d},saveuserinfo:function(){var d={avatar:e.userinfo.avatar,gender:e.userinfo.gender,name:e.userinfo.name,mobile:e.userinfo.mobile,idCard:e.userinfo.idCard,province:e.userinfo.province,provinceCode:e.userinfo.provinceCode,city:e.userinfo.city,cityCode:e.userinfo.cityCode,area:e.userinfo.area,areaCode:e.userinfo.areaCode,street:e.userinfo.street};$.ajax({url:$.apiUrl+"/user/detail",type:"POST",data:JSON.stringify(d)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改成功！"),a.getDetail()})})},getcode:function(){e.counting||(e.counting=!0,$.ajax({url:$.apiUrl+"/captcha",type:"PUT",data:JSON.stringify({mobile:e.repwd.mobile})}).done(function(d){$.ylbAjaxHandler(d,function(){$.ylbAlert("发送成功"),e.countdown=setInterval(a.countDown,1e3)})}))},resetpwd:function(){$.ajax({url:$.apiUrl+"/user/password/reset",type:"POST",data:JSON.stringify(e.repwd)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("修改成功！"),e.newpwd=!1})})}}}),a.createQRcode()}};a.init()}();