!function(){var e={sid:$.getID(),avatar:!1,address:!1,password:!0,detail:!1,confirmpwd:"",pwd:{currentPassword:"",newPassword:""},newaddress:{id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1},userinfo:{gender:"f",name:"",mobile:"",idCard:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:""},useravatar:"",plist:[],clist:[],alist:[]},a={init:function(){$.checkSession(),a.getPlist(),a.getUserInfo(),a.uploadavatar()},uploadavatar:function(){$("#txsc").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.useravatar=r.data}})},createQRcode:function(){var a="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;$("#customer-private-qrcode").qrcode({render:"table",width:130,height:130,text:a})},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.info=r.data,e.useravatar=r.data.avatar,a.getAddress()})})},getAddress:function(){$.when($.ajax({url:$.apiUrl+"/user/addresses",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.addrList=r.data,a.getDetail()})})},getDetail:function(){$.when($.ajax({url:$.apiUrl+"/user/detail",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.userDetail=r.data,e.userinfo=r.data,a.buildVue()})})},getPlist:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.plist=a.data})})},getClist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.clist=a.data})})},getAlist:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.alist=a.data})})},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{changetap:function(e){var a=$(e.target),r=a.attr("data-role");switch(r){case"avatar":this.avatar=!0,this.address=!1,this.password=!1,this.detail=!1;break;case"address":this.avatar=!1,this.address=!0,this.password=!1,this.detail=!1;break;case"password":this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1;break;case"detail":this.avatar=!1,this.address=!1,this.password=!1,this.detail=!0;break;default:this.avatar=!1,this.address=!1,this.password=!0,this.detail=!1}},setpaypwd:function(){return e.confirmpwd!==e.pwd.newPassword?void alert("两次输入的密码不一致"):void $.ajax({url:$.apiUrl+"/user/password",type:"POST",data:JSON.stringify(e.pwd)}).done(function(a){$.ylbAjaxHandler(a,function(){alert("密码设置成功"),e.pwd={currentPassword:"",newPassword:""},e.confirmpwd="",$.localStorageHandler("set","flag",!0),setTimeout(function(){var e=$.urlParam("url");e&&(window.location.href=e)},1500)})})},changeprov:function(r){var d=$(r.target),t=d.val(),s=d.find("option:selected").text();e.newaddress.provinceCode=t,e.newaddress.province=s,e.userinfo.provinceCode=t,e.userinfo.province=s,e.alist=[],a.getClist(t)},changecity:function(r){var d=$(r.target),t=d.val(),s=d.find("option:selected").text();e.newaddress.cityCode=t,e.newaddress.city=s,e.userinfo.cityCode=t,e.userinfo.city=s,a.getAlist(t)},changearea:function(a){var r=$(a.target),d=r.val(),t=r.find("option:selected").text();e.newaddress.areaCode=d,e.newaddress.area=t,e.userinfo.areaCode=d,e.userinfo.area=t},editaddress:function(r){e.newaddress.id=r.addressID,e.newaddress.name=r.name,e.newaddress.mobile=r.mobile,e.newaddress.province=r.province,e.newaddress.provinceCode=r.provinceCode,e.newaddress.city=r.city,e.newaddress.cityCode=r.cityCode,e.newaddress.area=r.area,e.newaddress.areaCode=r.areaCode,e.newaddress.street=r.street,e.newaddress.postCode=r.postCode,e.newaddress.isDefault=r.isDefault,a.getClist(r.provinceCode),a.getAlist(r.cityCode)},clearaddress:function(){e.newaddress={id:"",name:"",mobile:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",postCode:"",isDefault:1}},saveaddress:function(){if(e.newaddress.id){var r={id:e.newaddress.id,name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"POST",data:JSON.stringify(r)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改地址成功"),a.getAddress()})})}else{var r={name:e.newaddress.name,mobile:e.newaddress.mobile,province:e.newaddress.province,provinceCode:e.newaddress.provinceCode,city:e.newaddress.city,cityCode:e.newaddress.cityCode,area:e.newaddress.area,areaCode:e.newaddress.areaCode,street:e.newaddress.street,postCode:e.newaddress.postCode,isDefault:1};$.ajax({url:$.apiUrl+"/user/address",type:"PUT",data:JSON.stringify(r)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("地址添加成功"),a.getAddress()})})}},saveavatar:function(){$.ajax({url:$.apiUrl+"/user/avatar",type:"POST",data:JSON.stringify({avatar:e.useravatar})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("上传成功"),setTimeout(function(){window.location.href=window.location.href},1500)})})},changegender:function(a){var r=$(a.target).find("option:selected").val();e.userinfo.gender=r},saveuserinfo:function(){var a={avatar:e.userinfo.avatar,gender:e.userinfo.gender,name:e.userinfo.name,mobile:e.userinfo.mobile,idCard:e.userinfo.idCard,province:e.userinfo.province,provinceCode:e.userinfo.provinceCode,city:e.userinfo.city,cityCode:e.userinfo.cityCode,area:e.userinfo.area,areaCode:e.userinfo.areaCode,street:e.userinfo.street};$.ajax({url:$.apiUrl+"/user/detail",type:"POST",data:JSON.stringify(a)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("修改成功！")})})}}}),a.createQRcode()}};a.init()}();