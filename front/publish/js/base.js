!function(e){"use strict";e.apiUrl="/api",e.ajaxSetup({contentType:"application/json; charset=utf-8",beforeSend:function(t){t.setRequestHeader("sid",e.getID())}}),e.checkSession=function(){var t=e.getID(),r=window.location.href;t||(window.location.href="login.html?url="+r)},e.ylbError=function(t){if("1001"===t){e.clearID();var r=window.location.href;window.location.href="login.html?url="+r}else if(2001===t)e.ylbAlert("服务器开小差了,请稍后重试...");else switch(t){case"4001":e.ylbAlert("验证码错误");break;case"4002":e.ylbAlert("验证码过期");break;case"4003":e.ylbAlert("抵扣的积分超过允许上限");break;case"4004":e.ylbAlert("没有足够的积分用来抵扣");break;case"4005":e.ylbAlert("找不到用户");break;case"4006":e.ylbAlert("查询不到商品");break;case"4007":e.ylbAlert("已支付的订单不能取消");break;case"4008":e.ylbAlert("暂无可领取积分");break;case"4009":e.ylbAlert("领取积分失败");break;case"4010":e.ylbAlert("积分点为0");break;default:e.ylbAlert("服务器又开小差")}},e.ylbAjaxHandler=function(t,r,a){t.result?r():(e.ylbError(t.error),a&&a())},e.ylbAlert=function(t,r){var a=(e(window).width()-240)/2;r=r||1500;var l=['<div class="ylb-alert">',t,"</div>"],n=e(l.join("")).css("left",a).appendTo("body");n.show(),setTimeout(function(){n.remove()},r)},e.urlParam=function(e,t){t||(t=window.location.href);try{var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return r?r[1]||"":""}catch(a){return""}},e.regexUrl=function(e){e||(e=window.location.href);var t=new Array;return t=e.split("?url="),t[1]?t[1]:(t=e.split("&url="),t[1])},e.localStorageHandler=function(e,t,r){switch(e){case"set":localStorage.setItem(t,r);break;case"get":return localStorage.getItem(t);case"clear":localStorage.removeItem(t);break;case"clearall":localStorage.clear()}},e.setID=function(e){localStorage.setItem("sid",e)},e.getID=function(){return localStorage.getItem("sid")},e.clearID=function(){localStorage.removeItem("sid")},e.parseHandler=function(t,r){switch(t){case"js":return JSON.stringify(r);case"sj":return e.parseJSON(r)}},e.ylbAddCart=function(t,r){var a=e.localStorageHandler("get",t);if(a){for(var l=e.parseHandler("sj",a),n=!1,o=0,c=l.length;c>o;o++)if(l[o].goodsID==r.goodsID){n=!0;break}n?e.ylbAlert("商品已添加购物车"):(r="["+a.substring(1,a.length-1)+","+e.parseHandler("js",r)+"]",e.localStorageHandler("set",t,r),e.ylbAlert("添加成功"))}else e.localStorageHandler("set",t,"["+e.parseHandler("js",r)+"]"),e.ylbAlert("添加成功")},e.ylbRemoveCart=function(t,r){for(var a=e.localStorageHandler("get",t),l=e.parseHandler("sj",a),n="",o=0,c=l.length;c>o;o++)l[o].goodsID!=r&&(n+=e.parseHandler("js",l[o])+",");n="["+n.substring(0,n.length-1)+"]",e.localStorageHandler("set",t,n)}}(jQuery),function(){$(".logout").on("click",function(){$.clearID(),window.location.href="login.html"}),$(".ylb-search").on("click",function(){$(".ylb-cover").fadeIn(),$(".ylb-search-wrap").fadeIn()}),$(".ylb-menu").on("click",function(){$(".ylb-cover").fadeIn(),$(".ylb-menu-wrap").fadeIn()}),$(".ylb-cover, .ylb-menu-wrap").on("click",function(){$(".ylb-cover").fadeOut(),$(".ylb-search-wrap").fadeOut(),$(".ylb-menu-wrap").fadeOut()});var e={sc:""},t={init:function(){t.getFList()},getFList:function(){$.when($.ajax({url:$.apiUrl+"/goods/kinds",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.flist=r.data,t.getSList(e.flist[0].code)})})},getSList:function(r){$.when($.ajax({url:$.apiUrl+"/goods/kinds?code="+r,type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.slist=r.data,t.buildVue()})})},buildVue:function(){e=new Vue({el:"#ylb-layout",data:e,methods:{search:function(){this.sc?location.href="list.html?n="+this.sc:location.href="list.html"},changeslist:function(e){var r=e.target.attributes["data-id"].value;t.getSList(r)}}})}};t.init()}();