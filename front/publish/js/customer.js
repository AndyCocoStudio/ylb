!function(){var e={imgsize:5,sz:10,hcp:1,ht:0,scp:1,st:0,xcp:1,xt:0,zcp:1,zt:0,zczcp:1,zczct:0,cmcp:1,cmt:0,jscp:1,jst:0,zdcp:1,zdt:0,fjscp:1,fjst:0,fzdcp:1,fzdt:0,pcode:"",rcode:"",covershow:!1,sendshow:!1,spendshow:!1,applyrole:-1,isapplyunder:!1,isapplymanager:!1,nagtive:!1,ordernagtive:!1,sid:$.getID(),counting:!1,countdown:0,num:60,appID:"",order:[],jfdh:!0,xsxf:!1,sjzd:!1,reason:"",orderreason:"",role:"-1",plist:[],clist:[],alist:[],grefund:!1,refundgoods:{},refundobj:{kind:"1",img:"",expressNum:"",expressCompany:"",reason:"",goodsinfo:{}},zdsh:!0,jssh:!1,fzdsh:!1,fjssh:!1,zczc:!1,zzsjzd:!1,spendpoint:{name:"",type:"",count:"",total:"",point:"",mobile:""},reward:{way:1,amount:0,account:"",bank:""},total:{},tj:{mobile:"",captcha:"",referrerMobile:""},tobesaler:{referrerMobile:"",idCard:"",storeName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",legalPerson:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:"",storeAppearance:"",storeInsideImages:[],license:""},tobearea:{street:"",applicantName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",idCard:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:""}},t={init:function(){$.checkSession(),$.checkFlag(),t.getUserInfo(),t.getProvince()},getProvince:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.plist=t.data})})},getCity:function(t){$.when($.ajax({url:$.apiUrl+"/address?code="+t,type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.clist=t.data})})},getArea:function(t){$.when($.ajax({url:$.apiUrl+"/address?code="+t,type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.alist=t.data})})},imgUpload:function(){$("#tksmt").dropzone({init:function(){this.on("removedfile",function(t){e.refundobj.img=""})},url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,r){e.refundobj.img=r.data}}),$("#yyzz").dropzone({init:function(){this.on("removedfile",function(t){e.tobesaler.license=""})},url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,r){e.tobesaler.license=r.data}}),$("#frsfz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:2,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!1,dictResponseError:"上传文件出错！",success:function(t,r){e.tobesaler.legalPersonIDCardImage.push(r.data)}}),$("#zmt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!1,dictResponseError:"上传文件出错！",success:function(t,r){e.tobesaler.legalPersonWithIDCardInHandImage=r.data}}),$("#dzt").dropzone({init:function(){this.on("removedfile",function(t){e.tobesaler.storeAppearance=""})},url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,r){e.tobesaler.storeAppearance=r.data}}),$("#dnt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:4,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!1,dictResponseError:"上传文件出错！",success:function(t,r){e.tobesaler.storeInsideImages.push(r.data)}}),$("#areafr").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:2,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!1,dictResponseError:"上传文件出错！",success:function(t,r){e.tobearea.legalPersonIDCardImage.push(r.data)}}),$("#areasfz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:e.imgsize,acceptedFiles:"image/*",addRemoveLinks:!1,dictResponseError:"上传文件出错！",success:function(t,r){e.tobearea.legalPersonWithIDCardInHandImage=r.data}})},createQRcode:function(){var t="http://www.hnylbsc.com/func.html?mobile="+e.info.mobile;e.pcode||(e.pcode=$("#customer-private-qrcode").qrcode({render:"canvas",width:140,height:140,text:t}))},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.info=r.data,e.tj.referrerMobile=r.data.mobile,t.getJFDHOrder()})})},getJFDHOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=1&cp="+e.hcp+"&sz="+e.sz,type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.jfdhlist=r.data.orders,e.ht=r.data.totalCount,t.getXSXFOrder()})})},getXSXFOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=2&cp="+e.xcp+"&sz="+e.sz,type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.xsxflist=r.data.orders,e.xt=r.data.totalCount,t.getSJZDOrder()})})},getSJZDOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=0&cp="+e.scp+"&sz="+e.sz,type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.sjzdlist=r.data.orders,e.st=r.data.totalCount,t.getZZSJZDOrder()})})},getZZSJZDOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=3&cp="+e.zcp+"&sz="+e.sz,type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.zzsjzdlist=r.data.orders,e.zt=r.data.totalCount,"CustomerManager"==e.info.role||"AreaManager"==e.info.role||"AM"==e.info.role||"CM"==e.info.role?t.getTotal():t.buildVue()})})},getTotal:function(){$.when($.ajax({url:$.apiUrl+"/user/wage",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.total=r.data,t.buildVue()})})},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{tprev:function(){e.hcp<=1||(e.hcp=+e.hcp-1,t.getJFDHOrder())},tnext:function(){e.hcp>=Math.ceil(e.ht/e.sz)||(e.hcp=+e.hcp+1,t.getJFDHOrder())},tjump:function(){e.hcp>=Math.ceil(e.ht/e.sz)&&(e.hcp=Math.ceil(e.ht/e.sz)),e.hcp<=1&&(e.hcp=1),t.getJFDHOrder()},xprev:function(){e.xcp<=1||(e.xcp=+e.xcp-1,t.getXSXFOrder())},xnext:function(){e.xcp>=Math.ceil(e.xt/e.sz)||(e.xcp=+e.xcp+1,t.getXSXFOrder())},xjump:function(){e.xcp>=Math.ceil(e.xt/e.sz)&&(e.xcp=Math.ceil(e.xt/e.sz)),e.xcp<=1&&(e.xcp=1),t.getXSXFOrder()},sprev:function(){e.scp<=1||(e.scp=+e.scp-1,t.getSJZDOrder())},snext:function(){e.scp>=Math.ceil(e.st/e.sz)||(e.scp=+e.scp+1,t.getSJZDOrder())},sjump:function(){e.scp>=Math.ceil(e.st/e.sz)&&(e.scp=Math.ceil(e.st/e.sz)),e.scp<=1&&(e.scp=1),t.getSJZDOrder()},zprev:function(){e.zcp<=1||(e.zcp=+e.zcp-1,t.getZZSJZDOrder())},znext:function(){e.zcp>=Math.ceil(e.zt/e.sz)||(e.zcp=+e.zcp+1,t.getZZSJZDOrder())},zjump:function(){e.zcp>=Math.ceil(e.zt/e.sz)&&(e.zcp=Math.ceil(e.zt/e.sz)),e.zcp<=1&&(e.zcp=1),t.getZZSJZDOrder()},selectorder:function(t){switch(t){case 1:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1,e.zzsjzd=!1;break;case 2:e.jfdh=!1,e.sjzd=!1,e.xsxf=!0,e.zzsjzd=!1;break;case 3:e.jfdh=!1,e.sjzd=!0,e.xsxf=!1,e.zzsjzd=!1;break;case 4:e.jfdh=!1,e.sjzd=!1,e.xsxf=!1,e.zzsjzd=!0;break;default:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1,e.zzsjzd=!1}},sendpoints:function(){this.covershow=!0,this.sendshow=!0},spendpoints:function(){this.covershow=!0,this.spendshow=!0},hideall:function(){this.covershow=!1,this.sendshow=!1,this.spendshow=!1,this.nagtive=!1,this.grefund=!1,this.ordernagtive=!1,this.zczc=!1},pchange:function(){this.spendpoint.point>this.spendpoint.total&&(this.spendpoint.point=this.spendpoint.total.toFixed(2))},getqrcode:function(){$.ajax({url:$.apiUrl+"/order/shoppingoffline",type:"PUT",data:JSON.stringify({goodsName:e.spendpoint.name,goodsKind:e.spendpoint.type,userMobile:e.spendpoint.mobile,score:e.spendpoint.point,quantity:e.spendpoint.count,totalPrice:e.spendpoint.total})}).done(function(e){$.ylbAjaxHandler(e,function(){var t="http://www.hnylbsc.com/pay.html?oid="+e.data;$("#spendpoint-qrcode").qrcode({render:"canvas",width:240,height:240,text:t})})})},showreject:function(e){alert(e)},setobj:function(t){t.target.value==e.info.mobile&&($.ylbAlert("该手机号码不可用"),$(t.target).focus())},getpoint:function(){$.ajax({url:$.apiUrl+"/score",type:"GET"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("领取成功！"),t.getUserInfo()})})},changerewardway:function(t){var r=$(t.target).find("option:selected").val();e.reward.way=r},rolechange:function(t){e.role=$(t.target).val()},changeprov:function(r){var a=$(r.target),n=a.val(),o=a.find("option:selected").text();e.tobesaler.provinceCode=n,e.tobesaler.province=o,e.tobearea.provinceCode=n,e.tobearea.province=o,e.alist=[],t.getCity(n)},changecity:function(r){var a=$(r.target),n=a.val(),o=a.find("option:selected").text();e.tobesaler.cityCode=n,e.tobesaler.city=o,e.tobearea.cityCode=n,e.tobearea.city=o,t.getArea(n)},changearea:function(t){var r=$(t.target),a=r.val(),n=r.find("option:selected").text();e.tobesaler.areaCode=a,e.tobesaler.area=n,e.tobearea.areaCode=a,e.tobearea.area=n},apysaler:function(){if(e.isapplyunder){if(!e.tobesaler.idCard)return void $.ylbAlert("请输入法人身份证号");if(!e.tobesaler.storeName)return void $.ylbAlert("请输入店铺名称");if(!e.tobesaler.province)return void $.ylbAlert("请选择省");if(!e.tobesaler.city)return void $.ylbAlert("请选择市");if(!e.tobesaler.area)return void $.ylbAlert("请选择区");if(!e.tobesaler.street)return void $.ylbAlert("请输入详细街道地址");if(!e.tobesaler.legalPerson)return void $.ylbAlert("请输入真实姓名");if(e.tobesaler.storeInsideImages.length<1)return void $.ylbAlert("请上传店铺内饰图");if(!e.tobesaler.storeAppearance)return void $.ylbAlert("请上传店招图");if(!e.tobesaler.license)return void $.ylbAlert("请上传营业执照图");$.ajax({url:$.apiUrl+"/user/merchant",type:"PUT",data:JSON.stringify(e.tobesaler)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("申请成功！"),setTimeout(function(){window.location.href=window.location.href},1500)})})}else $.ylbAlert("阅读地面商家加盟合作条款并勾选已读")},apymanager:function(){if(e.isapplymanager){if(!e.tobearea.applicantName)return void $.ylbAlert("请输入申请人姓名");if(!e.tobearea.province)return void $.ylbAlert("请选择省");if(!e.tobearea.city)return void $.ylbAlert("请选择市");if(!e.tobearea.area)return void $.ylbAlert("请选择区");if(e.tobearea.legalPersonIDCardImage.length<1)return void $.ylbAlert("请上传身份证正反面照");if(!e.tobearea.idCard)return void $.ylbAlert("请输入法人身份证号");$.ajax({url:$.apiUrl+"/user/customermanager",type:"PUT",data:JSON.stringify(e.tobearea)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("申请成功！"),setTimeout(function(){window.location.href=window.location.href},1500)})})}else $.ylbAlert("阅读地面商家加盟合作条款并勾选已读")},cancel:function(e){var r=confirm("确认取消该订单？");r&&$.ajax({url:$.apiUrl+"/order/cancel?orderID="+e,type:"DELETE"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("删除成功"),t.getJFDHOrder()})})},recharge:function(){$.ylbConfirm({msg:"请输入充值金额<input type='text' class='recharge'>",callback:function(){var e=$(".recharge").val();$.ajax({url:$.apiUrl+"/order/recharge",type:"PUT",data:JSON.stringify({amount:e})}).done(function(e){$.ylbAjaxHandler(e,function(){window.location.href="pay.html?oid="+e.data})})}})},rewards:function(){e.zczc=!0,e.covershow=!0},selunder:function(t){e.isapplyunder=$(t.target).is(":checked")},selmanager:function(t){e.isapplymanager=$(t.target).is(":checked")},dorewards:function(){var t="";switch(e.reward.way){case"1":t="/transfer/paymentforgoods";break;case"2":t="/transfer/commission";break;case"3":t="/transfer/balance";break;default:t="/transfer/paymentforgoods"}return e.reward.amount?e.reward.account?void $.ajax({url:$.apiUrl+t,type:"PUT",data:JSON.stringify({amount:e.reward.amount,account:e.reward.account,bank:e.reward.bank})}).done(function(t){$.ylbAjaxHandler(t,function(){$.ylbAlert("转出申请成功"),e.hideall(),setTimeout(function(){window.location.href=window.location.href},1500)})}):void $.ylbAlert("请输入账号"):void $.ylbAlert("请输入转出金额")},getgoods:function(e){var r=confirm("确认收货？");r&&$.ajax({url:$.apiUrl+"/order/receive",type:"POST",data:JSON.stringify({orderID:e})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("操作成功"),t.getXSXFOrder()})})},selrefundkind:function(t){var r=$(t.target).find("option:selected").val();e.refundobj.kind=r},showrefund:function(t){var r=$(t.target),a=r.attr("data-index"),n=r.parent().parent().parent().parent().parent().parent().attr("data-index");e.refundobj.goodsinfo=e.xsxflist[n],e.refundgoods=e.refundobj.goodsinfo.items[a],e.refundobj.kind="1",e.refundobj.img="",e.refundobj.expressNum="",e.refundobj.expressCompany="",e.refundobj.reason="",$.when($.ajax({url:$.apiUrl+"/order/refund/freight?oid="+e.refundobj.goodsinfo.orderID,type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.refundobj.goodsinfo.freight=t.data.freight,e.covershow=!0,e.grefund=!0})})},torefund:function(){var r=confirm("确认退款？");if(r){var a=[];console.log(e.refundobj.img),a.push(e.refundobj.img),$.ajax({url:$.apiUrl+"/order/refund",type:"POST",data:JSON.stringify({orderID:e.refundobj.goodsinfo.orderID,orderItemID:e.refundgoods.orderItemID,amount:e.refundgoods.price,freight:e.refundobj.goodsinfo.freight,kind:e.refundobj.kind,expressCompany:e.refundobj.expressCompany,expressNum:e.refundobj.expressNum,reason:e.refundobj.reason,images:a})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("操作成功"),t.getXSXFOrder()})})}}}}),t.createQRcode(),setTimeout(t.imgUpload(),300)},countDown:function(){e.num>1?(e.num-=1,$(".btn-code").val(e.num+"秒后重新获取")):(e.counting=!1,$(".btn-code").val("重新获取"),e.num=60,clearInterval(e.countdown))}};t.init()}();