!function(){var e={covershow:!1,sendshow:!1,spendshow:!1,applyrole:-1,sid:$.getID(),jfdh:!0,xsxf:!1,sjzd:!1,role:"-1",plist:[],clist:[],alist:[],spendpoint:{name:"",type:"",count:"",total:"",point:"",mobile:""},total:{},tj:{mobile:"",captcha:"",referrerMobile:""},tobesaler:{referrerMobile:"",storeName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",legalPersonIDCardImage:"",legalPersonWithIDCardInHandImage:"",storeAppearance:"",storeInsideImages:[],license:""}},t={init:function(){$.checkSession(),$.checkFlag(),t.getUserInfo(),t.imgUpload(),t.getProvince()},getProvince:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.plist=t.data})})},getCity:function(t){$.when($.ajax({url:$.apiUrl+"/address?code="+t,type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.clist=t.data})})},getArea:function(t){$.when($.ajax({url:$.apiUrl+"/address?code="+t,type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.alist=t.data})})},imgUpload:function(){$("#yyzz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,n){e.tobesaler.license=n.data}}),$("#frsfz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,n){e.tobesaler.legalPersonIDCardImage=n.data}}),$("#zmt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,n){e.tobesaler.legalPersonWithIDCardInHandImage=n.data}}),$("#dzt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,n){e.tobesaler.storeAppearance=n.data}}),$("#dnt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:4,maxFilesize:4,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(t,n){e.tobesaler.storeInsideImages.push(n.data)}})},createQRcode:function(){var t="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;$("#customer-private-qrcode").qrcode({render:"table",width:140,height:120,text:t})},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.info=n.data,e.tj.referrerMobile=n.data.mobile,"AreaManager"==e.role?t.getApply():t.getJFDHOrder()})})},getApply:function(){$.when($.ajax({url:$.apiUrl+"/applies",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.apply=n.data.applies,t.getJFDHOrder()})})},getJFDHOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=1",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.jfdhlist=n.data.orders,t.getXSXFOrder()})})},getXSXFOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=2",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.xsxflist=n.data.orders,"Merchants"==e.info.role?t.getSJZDOrder():t.buildVue()})})},getSJZDOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=0",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.sjzdlist=n.data.orders,"CustomerManager"==e.info.role||"AreaManager"==e.info.role?t.getTotal():t.buildVue()})})},getTotal:function(){$.when($.ajax({url:$.apiUrl+"/user/wage",type:"GET"})).done(function(n){$.ylbAjaxHandler(n,function(){e.total=n.data,t.buildVue()})})},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{selectorder:function(t){switch(t){case 1:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1;break;case 2:e.jfdh=!1,e.sjzd=!1,e.xsxf=!0;break;case 3:e.jfdh=!1,e.sjzd=!0,e.xsxf=!1;break;default:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1}},sendpoints:function(){this.covershow=!0,this.sendshow=!0},spendpoints:function(){this.covershow=!0,this.spendshow=!0},hideall:function(){this.covershow=!1,this.sendshow=!1,this.spendshow=!1},pchange:function(){this.spendpoint.point>.8*this.spendpoint.total&&(this.spendpoint.point=(.8*this.spendpoint.total).toFixed(2))},getqrcode:function(){this.createSpendpointQRcode()},getpoint:function(){this.getPointPerDay()},rolechange:function(t){e.role=$(t.target).val()},changeprov:function(n){var a=$(n.target),o=a.val(),i=a.find("option:selected").text();e.tobesaler.provinceCode=o,e.tobesaler.province=i,e.alist=[],t.getCity(o)},changecity:function(n){var a=$(n.target),o=a.val(),i=a.find("option:selected").text();e.tobesaler.cityCode=o,e.tobesaler.city=i,t.getArea(o)},changearea:function(t){var n=$(t.target),a=n.val(),o=n.find("option:selected").text();e.tobesaler.areaCode=a,e.tobesaler.area=o},apysaler:function(){$.ajax({url:$.apiUrl+"/user/merchant",type:"PUT",data:JSON.stringify(e.tobesaler)}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("申请成功！")})})},logon:function(){$.ajax({url:$.apiUrl+"/user/register",type:"PUT",data:JSON.stringify(e.tj)}).done(function(t){$.ylbAjaxHandler(t,function(){$.ylbAlert("创建成功"),e.tj={mobile:"",captcha:"",referrerMobile:""}})})},getPointPerDay:function(){$.ajax({url:$.apiUrl+"/score",type:"GET"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("领取成功！"),t.getUserInfo()})})},createSpendpointQRcode:function(){$.ajax({url:$.apiUrl+"/order/shoppingoffline",type:"PUT",data:JSON.stringify({goodsName:e.spendpoint.name,goodsKind:e.spendpoint.type,userMobile:e.spendpoint.mobile,score:e.spendpoint.point,quantity:e.spendpoint.count,totalPrice:e.spendpoint.total})}).done(function(e){$.ylbAjaxHandler(e,function(){var t="http://www.hnylbsc.com/spendpoint.html?oid="+e.data;$("#spendpoint-qrcode").qrcode({render:"table",width:240,height:240,text:t})})})}}}),t.createQRcode()}};t.init()}();