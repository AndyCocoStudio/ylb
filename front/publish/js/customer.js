!function(){var e={covershow:!1,sendshow:!1,spendshow:!1,applyrole:-1,sid:$.getID(),jfdh:!0,xsxf:!1,sjzd:!1,spendpoint:{name:"",type:"",count:"",total:"",point:"",mobile:""}},n={init:function(){$.checkSession(),n.getUserInfo()},createQRcode:function(){var n="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;$("#customer-private-qrcode").qrcode({render:"table",width:130,height:130,text:n})},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.info=t.data,n.getJFDHOrder()})})},getJFDHOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=1",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.jfdhlist=t.data.orders,n.getXSXFOrder()})})},getXSXFOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=2",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.xsxflist=t.data.orders,"Merchants"==e.info.role?n.getSJZDOrder():n.buildVue()})})},getSJZDOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=0",type:"GET"})).done(function(t){$.ylbAjaxHandler(t,function(){e.sjzdlist=t.data.orders,n.buildVue()})})},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{selectorder:function(n){switch(n){case 1:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1;break;case 2:e.jfdh=!1,e.sjzd=!1,e.xsxf=!0;break;case 3:e.jfdh=!1,e.sjzd=!0,e.xsxf=!1;break;default:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1}},sendpoints:function(){this.covershow=!0,this.sendshow=!0},spendpoints:function(){this.covershow=!0,this.spendshow=!0},hideall:function(){this.covershow=!1,this.sendshow=!1,this.spendshow=!1},pchange:function(){this.spendpoint.point>.8*this.spendpoint.total&&(this.spendpoint.point=(.8*this.spendpoint.total).toFixed(2))},getqrcode:function(){this.createSpendpointQRcode()},getpoint:function(){this.getPointPerDay()},getPointPerDay:function(){$.ajax({url:$.apiUrl+"/score",type:"GET"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("领取成功！"),n.getUserInfo()})})},createSpendpointQRcode:function(){$.ajax({url:$.apiUrl+"/order/shoppingoffline",type:"PUT",data:JSON.stringify({goodsName:e.spendpoint.name,goodsKind:e.spendpoint.type,userMobile:e.spendpoint.mobile,score:e.spendpoint.point,quantity:e.spendpoint.count,totalPrice:e.spendpoint.total})}).done(function(e){$.ylbAjaxHandler(e,function(){var n="http://www.hnylbsc.com/spendpoint.html?oid="+e.data;$("#spendpoint-qrcode").qrcode({render:"table",width:240,height:240,text:n})})})}}}),n.createQRcode()}};n.init()}();