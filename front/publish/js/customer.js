!function(){var e={covershow:!1,sendshow:!1,spendshow:!1,applyrole:-1,nagtive:!1,ordernagtive:!1,sid:$.getID(),appID:"",order:[],jfdh:!0,xsxf:!1,sjzd:!1,reason:"",orderreason:"",role:"-1",plist:[],clist:[],alist:[],zdsh:!0,jssh:!1,fzdsh:!1,fjssh:!1,spendpoint:{name:"",type:"",count:"",total:"",point:"",mobile:""},total:{},tj:{mobile:"",captcha:"",referrerMobile:""},tobesaler:{referrerMobile:"",idCard:"",storeName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",legalPerson:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:"",storeAppearance:"",storeInsideImages:[],license:""},tobearea:{street:"",applicantName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",idCard:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:""}},a={init:function(){$.checkSession(),$.checkFlag(),a.getUserInfo(),a.imgUpload(),a.getProvince()},getProvince:function(){$.when($.ajax({url:$.apiUrl+"/address",type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.plist=a.data})})},getCity:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.clist=a.data})})},getArea:function(a){$.when($.ajax({url:$.apiUrl+"/address?code="+a,type:"GET"})).done(function(a){$.ylbAjaxHandler(a,function(){e.alist=a.data})})},imgUpload:function(){$("#yyzz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobesaler.license=r.data}}),$("#frsfz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:2,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobesaler.legalPersonIDCardImage.push(r.data)}}),$("#zmt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobesaler.legalPersonWithIDCardInHandImage=r.data}}),$("#dzt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:1,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobesaler.storeAppearance=r.data}}),$("#dnt").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:4,maxFilesize:4,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobesaler.storeInsideImages.push(r.data)}}),$("#areafr").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:2,maxFilesize:4,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobearea.legalPersonIDCardImage.push(r.data)}}),$("#areasfz").dropzone({url:$.apiUrl+"/upload",paramName:"file",maxFiles:1,maxFilesize:4,acceptedFiles:"image/*",addRemoveLinks:!0,dictResponseError:"上传文件出错！",success:function(a,r){e.tobearea.legalPersonWithIDCardInHandImage=r.data}})},createQRcode:function(){var a="http://www.hnylbsc.com/sendpoint.html?uid="+e.info.mobile;$("#customer-private-qrcode").qrcode({render:"canvas",width:140,height:140,text:a})},getUserInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.info=r.data,e.tj.referrerMobile=r.data.mobile,"AreaManager"==e.info.role?a.getApply():a.getJFDHOrder()})})},getApply:function(){$.when($.ajax({url:$.apiUrl+"/applies?k=0",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.apply=r.data.applies,a.getOrder()})})},getOrder:function(){$.when($.ajax({url:$.apiUrl+"/givingscore",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.order=r.data.orders,a.getXSXFOrder()})})},getJFDHOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=1",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.jfdhlist=r.data.orders,a.getXSXFOrder()})})},getXSXFOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=2",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.xsxflist=r.data.orders,"Merchants"==e.info.role?a.getSJZDOrder():a.buildVue()})})},getSJZDOrder:function(){$.when($.ajax({url:$.apiUrl+"/user/orders?k=0",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.sjzdlist=r.data.orders,"CustomerManager"==e.info.role||"AreaManager"==e.info.role?a.getTotal():a.buildVue()})})},getTotal:function(){$.when($.ajax({url:$.apiUrl+"/user/wage",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.total=r.data,"CustomerManager"==e.info.role?a.getOrders():a.buildVue()})})},getOrders:function(){$.when($.ajax({url:$.apiUrl+"/customermanager/givingscore",type:"GET"})).done(function(r){$.ylbAjaxHandler(r,function(){e.customerorders=r.data,a.buildVue()})})},buildVue:function(){e=new Vue({el:"#customer-main",data:e,methods:{selectorder:function(a){switch(a){case 1:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1;break;case 2:e.jfdh=!1,e.sjzd=!1,e.xsxf=!0;break;case 3:e.jfdh=!1,e.sjzd=!0,e.xsxf=!1;break;default:e.jfdh=!0,e.sjzd=!1,e.xsxf=!1}},sendpoints:function(){this.covershow=!0,this.sendshow=!0},spendpoints:function(){this.covershow=!0,this.spendshow=!0},hideall:function(){this.covershow=!1,this.sendshow=!1,this.spendshow=!1,this.nagtive=!1,this.ordernative=!1},pchange:function(){this.spendpoint.point>.8*this.spendpoint.total&&(this.spendpoint.point=(.8*this.spendpoint.total).toFixed(2))},getqrcode:function(){$.ajax({url:$.apiUrl+"/order/shoppingoffline",type:"PUT",data:JSON.stringify({goodsName:e.spendpoint.name,goodsKind:e.spendpoint.type,userMobile:e.spendpoint.mobile,score:e.spendpoint.point,quantity:e.spendpoint.count,totalPrice:e.spendpoint.total})}).done(function(e){$.ylbAjaxHandler(e,function(){var a="http://www.hnylbsc.com/spendpoint.html?oid="+e.data;$("#spendpoint-qrcode").qrcode({render:"table",width:240,height:240,text:a})})})},getpoint:function(){$.ajax({url:$.apiUrl+"/score",type:"GET"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("领取成功！"),a.getUserInfo()})})},accepts:function(e){var r=confirm("确认同意该申请？");r&&$.ajax({url:$.apiUrl+"/apply/allow",type:"POST",data:JSON.stringify({applicationID:e})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("操作成功"),a.getApply()})})},selapprove:function(a){1==a?(e.zdsh=!0,e.jssh=!1,e.fzdsh=!1,e.fjssh=!1):2==a?(e.zdsh=!1,e.jssh=!0,e.fzdsh=!1,e.fjssh=!1):3==a?(e.zdsh=!1,e.jssh=!1,e.fzdsh=!0,e.fjssh=!1):4==a&&(e.zdsh=!1,e.jssh=!1,e.fzdsh=!1,e.fjssh=!0)},showreason:function(a){e.nagtive=!0,e.covershow=!0,e.appID=a},showrejectreason:function(e){alert(e)},reject:function(){$.ajax({url:$.apiUrl+"/apply/reject",type:"POST",data:JSON.stringify({applicationID:e.appID,reason:e.reason})}).done(function(r){$.ylbAjaxHandler(r,function(){$.ylbAlert("操作成功"),e.hideall(),a.getApply()})})},rolechange:function(a){e.role=$(a.target).val()},changeprov:function(r){var n=$(r.target),t=n.val(),o=n.find("option:selected").text();e.tobesaler.provinceCode=t,e.tobesaler.province=o,e.tobearea.provinceCode=t,e.tobearea.province=o,e.alist=[],a.getCity(t)},changecity:function(r){var n=$(r.target),t=n.val(),o=n.find("option:selected").text();e.tobesaler.cityCode=t,e.tobesaler.city=o,e.tobearea.cityCode=t,e.tobearea.city=o,a.getArea(t)},changearea:function(a){var r=$(a.target),n=r.val(),t=r.find("option:selected").text();e.tobesaler.areaCode=n,e.tobesaler.area=t,e.tobearea.areaCode=n,e.tobearea.area=t},apysaler:function(){$.ajax({url:$.apiUrl+"/user/merchant",type:"PUT",data:JSON.stringify(e.tobesaler)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("申请成功！"),e.tobesaler={referrerMobile:"",idCard:"",storeName:"",province:"",provinceCode:"",city:"",cityCode:"",area:"",areaCode:"",street:"",legalPerson:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:"",storeAppearance:"",storeInsideImages:[],license:""}})})},apymanager:function(){$.ajax({url:$.apiUrl+"/user/customermanager",type:"PUT",data:JSON.stringify(e.tobearea)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("申请成功！"),e.tobearea={applicantName:"",province:"",provinceCode:"",city:"",cityCode:"",street:"",area:"",areaCode:"",idCard:"",legalPersonIDCardImage:[],legalPersonWithIDCardInHandImage:""}})})},cancel:function(e){var r=confirm("确认取消该订单？");r&&$.ajax({url:$.apiUrl+"/order/cancel?orderID="+e,type:"DELETE"}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("删除成功"),a.getJFDHOrder()})})},logon:function(){$.ajax({url:$.apiUrl+"/user/register",type:"PUT",data:JSON.stringify(e.tj)}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("创建成功"),e.tj={mobile:"",captcha:"",referrerMobile:""}})})},showorderreason:function(a){e.orderID=a,this.cover=!0,this.ordernagtive=!0},agreeorder:function(e){var r=confirm("确认同意该申请？");r&&$.ajax({url:$.apiUrl+"/givingscore/agree",type:"POST",data:JSON.stringify({orderID:e})}).done(function(e){$.ylbAjaxHandler(e,function(){$.ylbAlert("操作成功"),a.getOrder()})})},disagreeorder:function(){$.ajax({url:$.apiUrl+"/givingscore/reject",type:"POST",data:JSON.stringify({orderID:e.orderID,reason:e.orderreason})}).done(function(r){$.ylbAjaxHandler(r,function(){$.ylbAlert("操作成功"),e.hideall(),a.getOrder()})})}}}),a.createQRcode()}};a.init()}();