!function(){var a={sz:20,mt:0,mcp:1,ot:0,ocp:1,ct:0,ccp:1,amct:0,amccp:1,amot:0,amocp:1,cmmt:0,cmmcp:1,cmot:0,cmocp:1,mobile:"",total:{count:[],area:{},customer:{},merchant:{}}},t={init:function(){t.getInfo()},getCount:function(){$.when($.ajax({url:$.apiUrl+"/mine/places",type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){switch(a.user.role){case"Merchants":a.total.count=c.data,t.merchants();break;case"CustomerManager":a.total.count=c.data,t.customerManager();break;case"AreaManager":a.total.count=c.data,t.areaManager();break;case"CM":for(var n=0;n<c.data.length;n++)"CustomerManager"!=c.data[n].role?"Merchants"!=c.data[n].role||(a.total.merchant=c.data[n]):a.total.customer=c.data[n];t.cm();break;case"AM":for(var n=0;n<c.data.length;n++)"AreaManager"!=c.data[n].role?"Merchants"!=c.data[n].role||(a.total.merchant=c.data[n]):a.total.area=c.data[n];t.am();break;default:alert("您是普通会员，没有赠送体验积分权限"),window.location.href="customer.html"}})})},getInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.user=c.data,t.getCount()})})},merchants:function(){$.when($.ajax({url:$.apiUrl+"/merchant/users?cp="+a.ocp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.olist=c.data.users,a.ot=c.data.totalCount,t.buildVue()})})},customerManager:function(){$.when($.ajax({url:$.apiUrl+"/customermanager/merchants?cp="+a.mcp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.mlist=c.data.merchants,a.mt=c.data.totalCount,t.buildVue()})})},areaManager:function(){$.when($.ajax({url:$.apiUrl+"/area/customermanager?cp="+a.ccp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.clist=c.data.customerManagers,a.ct=c.data.totalCount,t.buildVue()})})},am:function(){$.when($.ajax({url:$.apiUrl+"/area/customermanager?cp="+a.amccp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.clist=c.data.customerManagers,a.amct=c.data.totalCount,$.when($.ajax({url:$.apiUrl+"/merchant/users?cp="+a.amocp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.olist=c.data.users,a.amot=c.data.totalCount,t.buildVue()})})})})},cm:function(){$.when($.ajax({url:$.apiUrl+"/customermanager/merchants?cp="+a.cmmcp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.mlist=c.data.merchants,a.cmmt=c.data.totalCount,$.when($.ajax({url:$.apiUrl+"/merchant/users?cp="+a.cmocp+"&sz="+a.sz,type:"GET"})).done(function(c){$.ylbAjaxHandler(c,function(){a.olist=c.data.users,a.cmot=c.data.totalCount,t.buildVue()})})})})},buildVue:function(){a=new Vue({el:"#taste-main",data:a,methods:{toc:function(a){var c=confirm("确定要赠送体验名额？");if(c){var n=$(a.target).attr("data-id"),e=$(a.target).prev("input").val();if(!e)return void $.ylbAlert("请输入赠送数量");$.ajax({url:$.apiUrl+"/customermanager/quota",type:"PUT",data:JSON.stringify({receiverID:n,quota:e})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}},tom:function(a){var c=confirm("确定要赠送体验名额？");if(c){var n=$(a.target).attr("data-id"),e=$(a.target).prev("input").val();if(!e)return void $.ylbAlert("请输入赠送数量");$.ajax({url:$.apiUrl+"/merchant/quota",type:"PUT",data:JSON.stringify({receiverID:n,quota:e})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}},too:function(a){var c=confirm("确定要赠送体验积分？");if(c){var n=$(a.target).attr("data-id");$.ajax({url:$.apiUrl+"/user/quota",type:"PUT",data:JSON.stringify({receiverID:n})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}},givept:function(){if(a.mobile){var c=confirm("确认要赠送积分给用户"+a.mobile+"?");c&&$.ajax({url:$.apiUrl+"/user/quota",type:"PUT",data:JSON.stringify({mobile:a.mobile})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}else $.ylbAlert("请输入手机号")},mprev:function(){a.mcp<=1||(a.mcp=+a.mcp-1,t.getCustomer())},mnext:function(){a.mcp>=Math.ceil(a.mt/a.sz)||(a.mcp=+a.mcp+1,t.getCustomer())},mjump:function(){a.mcp>=Math.ceil(a.mt/a.sz)&&(a.mcp=Math.ceil(a.mt/a.sz)),a.mcp<=1&&(a.mcp=1),t.getCustomer()},oprev:function(){a.ocp<=1||(a.ocp=+a.ocp-1,t.customerManager())},onext:function(){a.ocp>=Math.ceil(a.ot/a.sz)||(a.ocp=+a.ocp+1,t.customerManager())},ojump:function(){a.ocp>=Math.ceil(a.ot/a.sz)&&(a.ocp=Math.ceil(a.ot/a.sz)),a.ocp<=1&&(a.ocp=1),t.customerManager()},cprev:function(){a.ccp<=1||(a.ccp=+a.ccp-1,t.customerManager())},cnext:function(){a.ccp>=Math.ceil(a.ct/a.sz)||(a.ccp=+a.ccp+1,t.customerManager())},cjump:function(){a.ccp>=Math.ceil(a.ct/a.sz)&&(a.ccp=Math.ceil(a.ct/a.sz)),a.ccp<=1&&(a.ccp=1),t.customerManager()},amcprev:function(){a.amccp<=1||(a.amccp=+a.amccp-1,t.am())},amcnext:function(){a.amccp>=Math.ceil(a.amct/a.sz)||(a.amccp=+a.amccp+1,t.am())},amcjump:function(){a.amccp>=Math.ceil(a.amct/a.sz)&&(a.amccp=Math.ceil(a.amct/a.sz)),a.amccp<=1&&(a.amccp=1),t.am()},amoprev:function(){a.amocp<=1||(a.amocp=+a.amocp-1,t.am())},amonext:function(){a.amocp>=Math.ceil(a.amot/a.sz)||(a.amocp=+a.amocp+1,t.am())},amojump:function(){a.amocp>=Math.ceil(a.amot/a.sz)&&(a.amocp=Math.ceil(a.amot/a.sz)),a.amocp<=1&&(a.amocp=1),t.am()},cmmprev:function(){a.cmmcp<=1||(a.cmmcp=+a.cmmcp-1,t.cm())},cmmnext:function(){a.cmmcp>=Math.ceil(a.cmmt/a.sz)||(a.cmmcp=+a.cmmcp+1,t.cm())},cmmjump:function(){a.cmmcp>=Math.ceil(a.cmmt/a.sz)&&(a.cmmcp=Math.ceil(a.cmmt/a.sz)),a.cmmcp<=1&&(a.cmmcp=1),t.cm()},cmoprev:function(){a.cmocp<=1||(a.cmocp=+a.cmocp-1,t.cm())},cmonext:function(){a.cmocp>=Math.ceil(a.cmot/a.sz)||(a.cmocp=+a.cmocp+1,t.cm())},cmojump:function(){a.cmocp>=Math.ceil(a.cmot/a.sz)&&(a.cmocp=Math.ceil(a.cmot/a.sz)),a.cmocp<=1&&(a.cmocp=1),t.cm()}}})}};t.init()}();