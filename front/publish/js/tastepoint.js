!function(){var a={total:{count:[],area:{},customer:{},merchant:{}}},t={init:function(){t.getInfo()},getCount:function(){$.when($.ajax({url:$.apiUrl+"/mine/places",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){switch(a.user.role){case"Merchants":a.total.count=e.data,t.merchants();break;case"CustomerManager":a.total.count=e.data,t.customerManager();break;case"AreaManager":a.total.count=e.data,t.areaManager();break;case"CM":for(var n=0;n<e.data.length;n++)"CustomerManager"==e.data[n].role?a.total.customer=e.data[n]:a.total.customer="","Merchant"==e.data[n].role?a.total.merchant=e.data[n]:a.total.merchant="";t.cm();break;case"AM":for(var n=0;n<e.data.length;n++)"AreaManager"==e.data[n].role?a.total.area=e.data[n]:a.total.area="","Merchant"==e.data[n].role?a.total.merchant=e.data[n]:a.total.merchant="";t.am();break;default:alert("您是普通会员，没有赠送体验积分权限"),window.location.href="customer.html"}})})},getInfo:function(){$.when($.ajax({url:$.apiUrl+"/user/abstract",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.user=e.data,t.getCount()})})},merchants:function(){$.when($.ajax({url:$.apiUrl+"/merchant/users?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.olist=e.data.users,t.buildVue()})})},customerManager:function(){$.when($.ajax({url:$.apiUrl+"/customermanager/merchants?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.mlist=e.data.merchants,t.buildVue()})})},areaManager:function(){$.when($.ajax({url:$.apiUrl+"/area/customermanager?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.clist=e.data.customerManagers,t.buildVue()})})},am:function(){$.when($.ajax({url:$.apiUrl+"/area/customermanager?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.clist=e.data.customerManagers,$.when($.ajax({url:$.apiUrl+"/merchant/users?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.olist=e.data.users,t.buildVue()})})})})},cm:function(){$.when($.ajax({url:$.apiUrl+"/customermanager/merchants?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.mlist=e.data.merchants,$.when($.ajax({url:$.apiUrl+"/merchant/users?cp=1&sz=1000",type:"GET"})).done(function(e){$.ylbAjaxHandler(e,function(){a.olist=e.data.users,t.buildVue()})})})})},buildVue:function(){a=new Vue({el:"#taste-main",data:a,methods:{toc:function(a){var e=confirm("确定要赠送体验名额？");if(e){var n=$(a.target).attr("data-id"),r=$(a.target).prev("input").val();if(!r)return void $.ylbAlert("请输入赠送数量");$.ajax({url:$.apiUrl+"/customermanager/quota",type:"PUT",data:JSON.stringify({receiverID:n,quota:r})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}},tom:function(a){var e=confirm("确定要赠送体验名额？");if(e){var n=$(a.target).attr("data-id"),r=$(a.target).prev("input").val();if(!r)return void $.ylbAlert("请输入赠送数量");$.ajax({url:$.apiUrl+"/merchant/quota",type:"PUT",data:JSON.stringify({receiverID:n,quota:r})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}},too:function(a){var e=confirm("确定要赠送体验积分？");if(e){var n=$(a.target).attr("data-id");$.ajax({url:$.apiUrl+"/user/quota",type:"PUT",data:JSON.stringify({receiverID:n})}).done(function(a){$.ylbAjaxHandler(a,function(){$.ylbAlert("发送成功"),t.getCount()})})}}}})}};t.init()}();